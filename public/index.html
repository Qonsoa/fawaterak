  <!doctype html>
  <html lang="ar">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Checkout - Captain Gym</title>
    <style>
      #fawaterkDiv { width:100%; max-width:900px; margin:20px auto; min-height:500px; }
    </style>
  </head>
  <body>
    <h2 style="text-align:center">دفع اشتراك - Captain Gym</h2>

    <div id="fawaterkDiv"></div>

    <script src="https://app.fawaterk.com/fawaterkPlugin/fawaterkPlugin.min.js"></script>

    <script>
      // مثال بيانات الطلب - في مشروع حقيقي خدها من نموذج المستخدم
      const order = {
        cartTotal: 250,
        currency: 'EGP',
        customer: {
          first_name: 'Ahmad',
          last_name: 'Mohammad',
          email: 'ahmad@example.com',
          phone: '01012345678',
          address: 'Nasr City, Cairo'
        },
        cartItems: [{ name: 'اشتراك شهري - Captain Gym', price: '250', quantity: '1' }],
        payLoad: { userId: 'USER_12345', plan: 'monthly' },
        redirectionUrls: {
          successUrl: window.location.origin + '/thankyou.html',
          failUrl: window.location.origin + '/fail.html',
          pendingUrl: window.location.origin + '/pending.html'
        }
      };

      async function initFawaterak() {
        // أرسل إلى السيرفر لإنشاء invoice أو تجهيز requestBody + hash
        const res = await fetch('/api/fawaterak/create-invoice', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(order)
        });
        const data = await res.json();
        if (!data.ok) {
          alert('فشل إنشاء الفاتورة، راجع السجل على السيرفر');
          return;
        }

        const hashKey = data.hashKey;
        const requestBody = data.requestBody;

        // تهيئة plugin كما في docs
        const pluginConfig = {
          envType: "test",           // أو "live" عند التشغيل الفعلي حسب حسابك
          hashKey: hashKey,
          style: { listing: "vertical" },
          version: "0",
          requestBody: requestBody
        };

        const payment = new FawaterkPayment({
          container: '#fawaterkDiv',
          ...pluginConfig,
          onSuccess: function (response) {
            console.log('تم الدفع بنجاح', response);
            // إعادة توجيه لصفحة النجاح أو تحديث واجهة المستخدم
            window.location = requestBody.redirectionUrls.successUrl;
          },
          onFailure: function (err) {
            console.error('فشل الدفع', err);
            window.location = requestBody.redirectionUrls.failUrl;
          }
        });

        payment.render();
      }

      initFawaterak().catch(err => {
        console.error(err);
        alert('حدث خطأ أثناء تهيئة الدفع');
      });
    </script>
  </body>
  </html>